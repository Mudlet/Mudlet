language: cpp
os:
  - osx
  - linux
compiler:
  - gcc
env:
  - Q_OR_C_MAKE=qmake
  - Q_OR_C_MAKE=cmake
matrix:
  allow_failures:
  - env: Q_OR_C_MAKE=cmake
before_install: ./CI/travis.before_install.sh
install: ./CI/travis.install.sh
before_script:
  - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then PATH="/usr/local/opt/qt5/bin:$PATH"; fi
  - mkdir build
  - cd src
script:
  - cd ../build
  - if [ "${TRAVIS_OS_NAME}" = "osx" && "${Q_OR_C_MAKE}" = "cmake" ]; then echo Seeking zip internal header zipconf.h; pkg-config --variable includedir libzip; fi # Spotted recommendation to use pkg-config here https://github.com/Homebrew/homebrew/issues/13390
  - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then export LDFLAGS=" -L/usr/local/opt/qt5/lib ${LDFLAGS}"; export CPPFLAGS=" -I/usr/local/opt/qt5/include ${CPPFLAGS}"; fi
  - if [ "${Q_OR_C_MAKE}" = "qmake" ]; then qmake -v; qmake ../src/src.pro && make -j2; else cmake --version; cmake .. && make -j2; fi
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/4ed233d9013d611a1568
    on_success: always  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: false     # default: false
